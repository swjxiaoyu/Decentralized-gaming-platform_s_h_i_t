# 游戏链路协议规范 (Game Link Protocol)

## 1. 协议概述

### 1.1 协议目标
游戏链路协议（GLP - Game Link Protocol）是一个标准化的跨游戏资产转移和交易协议，旨在实现：
- 跨游戏资产互操作性
- 统一的资产转移接口
- 标准化的交易流程
- 可扩展的游戏生态

### 1.2 核心概念
- **游戏钱包 (Game Wallet)**: 每个游戏内的资产存储系统
- **资产类型 (Asset Type)**: 游戏内货币、道具、NFT等
- **转移链路 (Transfer Link)**: 游戏间的资产转移通道
- **协议网关 (Protocol Gateway)**: 统一的协议处理中心

## 2. 协议架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   游戏A钱包     │    │   游戏B钱包     │    │   游戏C钱包     │
│  (Game A)      │    │  (Game B)      │    │  (Game C)      │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   协议网关       │
                    │ (Protocol       │
                    │  Gateway)       │
                    └─────────────────┘
```

## 3. API 接口规范

### 3.1 基础信息接口

#### 3.1.1 获取钱包信息
```http
GET /api/v1/wallet/{walletId}/info
```

**响应示例:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "walletId": "game-a-wallet-001",
    "gameId": "game-a",
    "gameName": "魔法世界",
    "supportedAssets": [
      {
        "assetType": "currency",
        "assetId": "gold",
        "assetName": "金币",
        "decimals": 2,
        "totalSupply": "1000000.00"
      },
      {
        "assetType": "item",
        "assetId": "sword-001",
        "assetName": "魔法剑",
        "totalSupply": "100"
      }
    ],
    "lastActivity": "2025-01-18T10:30:00Z",
    "status": "active"
  }
}
```

#### 3.1.2 获取资产余额
```http
GET /api/v1/wallet/{walletId}/balance/{assetId}
```

**响应示例:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "walletId": "game-a-wallet-001",
    "assetId": "gold",
    "balance": "1500.50",
    "lastUpdated": "2025-01-18T10:30:00Z"
  }
}
```

### 3.2 资产转移接口

#### 3.2.1 发起转移请求
```http
POST /api/v1/transfer/initiate
```

**请求体:**
```json
{
  "transferId": "transfer-001",
  "sourceWallet": {
    "walletId": "game-a-wallet-001",
    "assetId": "gold",
    "amount": "100.00"
  },
  "targetWallet": {
    "walletId": "game-b-wallet-002",
    "assetId": "silver",
    "expectedAmount": "250.00"
  },
  "exchangeRate": {
    "fromAsset": "gold",
    "toAsset": "silver",
    "rate": "1:2.5",
    "lastUpdated": "2025-01-18T10:30:00Z"
  },
  "metadata": {
    "reason": "cross-game-trade",
    "playerId": "player-123",
    "description": "跨游戏金币兑换"
  },
  "expiryTime": "2025-01-18T11:30:00Z",
  "priority": "normal"
}
```

**响应示例:**
```json
{
  "code": 200,
  "message": "Transfer initiated successfully",
  "data": {
    "transferId": "transfer-001",
    "status": "pending",
    "createdAt": "2025-01-18T10:30:00Z",
    "expiryTime": "2025-01-18T11:30:00Z"
  }
}
```

#### 3.2.2 确认转移
```http
POST /api/v1/transfer/{transferId}/confirm
```

**响应示例:**
```json
{
  "code": 200,
  "message": "Transfer confirmed successfully",
  "data": {
    "transferId": "transfer-001",
    "status": "confirmed",
    "confirmedAt": "2025-01-18T10:35:00Z"
  }
}
```

#### 3.2.3 查询转移状态
```http
GET /api/v1/transfer/{transferId}/status
```

**响应示例:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "transferId": "transfer-001",
    "status": "completed",
    "progress": 100,
    "timeline": [
      {
        "timestamp": "2025-01-18T10:30:00Z",
        "status": "initiated",
        "message": "Transfer request created"
      },
      {
        "timestamp": "2025-01-18T10:35:00Z",
        "status": "confirmed",
        "message": "Transfer confirmed by both parties"
      },
      {
        "timestamp": "2025-01-18T10:40:00Z",
        "status": "completed",
        "message": "Transfer completed successfully"
      }
    ],
    "transactions": [
      {
        "txHash": "0x1234567890abcdef...",
        "blockNumber": 12345,
        "gasUsed": 21000,
        "gasPrice": "20000000000"
      }
    ]
  }
}
```

### 3.3 汇率查询接口

#### 3.3.1 获取汇率
```http
GET /api/v1/exchange/rate/{fromAsset}/{toAsset}
```

**响应示例:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "fromAsset": "gold",
    "toAsset": "silver",
    "rate": "1:2.5",
    "reverseRate": "2.5:1",
    "lastUpdated": "2025-01-18T10:30:00Z",
    "validUntil": "2025-01-18T11:30:00Z",
    "provider": "GameExchange",
    "confidence": 0.95
  }
}
```

## 4. 数据模型

### 4.1 钱包信息模型
```json
{
  "walletId": "string",
  "gameId": "string",
  "gameName": "string",
  "supportedAssets": [
    {
      "assetType": "currency|item|nft|token",
      "assetId": "string",
      "assetName": "string",
      "decimals": "number",
      "totalSupply": "string"
    }
  ],
  "lastActivity": "datetime",
  "status": "active|inactive|suspended|maintenance"
}
```

### 4.2 资产信息模型
```json
{
  "assetType": "currency|item|nft|token",
  "assetId": "string",
  "assetName": "string",
  "decimals": "number",
  "totalSupply": "string",
  "iconUrl": "string"
}
```

### 4.3 转移请求模型
```json
{
  "transferId": "string",
  "sourceWallet": {
    "walletId": "string",
    "assetId": "string",
    "amount": "string",
    "expectedAmount": "string"
  },
  "targetWallet": {
    "walletId": "string",
    "assetId": "string",
    "amount": "string",
    "expectedAmount": "string"
  },
  "exchangeRate": {
    "fromAsset": "string",
    "toAsset": "string",
    "rate": "string",
    "reverseRate": "string",
    "lastUpdated": "datetime",
    "validUntil": "datetime",
    "provider": "string",
    "confidence": "number"
  },
  "metadata": {
    "reason": "cross-game-trade|reward-transfer|purchase|gift|other",
    "gameSessionId": "string",
    "playerId": "string",
    "description": "string",
    "tags": ["string"]
  },
  "expiryTime": "datetime",
  "priority": "low|normal|high|urgent"
}
```

## 5. 错误处理

### 5.1 错误码定义
| 错误码 | 说明 |
|--------|------|
| 1000 | 请求格式错误 |
| 1001 | 缺少必需字段 |
| 1002 | 无效的资产ID |
| 1003 | 余额不足 |
| 1004 | 无效的钱包ID |
| 1005 | 无效的金额格式 |
| 1006 | 无效的转移ID |
| 2000 | 转移不存在 |
| 2001 | 转移已过期 |
| 2002 | 转移已完成 |
| 2003 | 转移已取消 |
| 2004 | 转移失败 |
| 3000 | 汇率不可用 |
| 3001 | 汇率已过期 |
| 3002 | 汇率无效 |
| 4000 | 钱包不存在 |
| 4001 | 钱包未激活 |
| 4002 | 钱包已暂停 |
| 4003 | 资产不支持 |
| 5000 | 服务器内部错误 |
| 5001 | 服务不可用 |
| 5002 | 数据库错误 |
| 5003 | 网络错误 |

### 5.2 错误响应格式
```json
{
  "code": 1003,
  "message": "Insufficient balance",
  "details": {
    "walletId": "game-a-wallet-001",
    "assetId": "gold",
    "requestedAmount": "1000.00",
    "availableBalance": "500.00"
  },
  "timestamp": "2025-01-18T10:30:00Z",
  "requestId": "req-123456"
}
```

## 6. 安全考虑

### 6.1 认证机制
- 所有API请求都需要包含有效的认证令牌
- 支持JWT令牌和API密钥两种认证方式
- 令牌需要定期刷新

### 6.2 权限控制
- 基于角色的访问控制（RBAC）
- 钱包级别的权限管理
- 操作级别的权限验证

### 6.3 数据保护
- 敏感数据加密存储
- 传输过程使用HTTPS
- 定期安全审计

## 7. 性能要求

### 7.1 响应时间
- API响应时间 < 200ms
- 转移确认时间 < 5s
- 状态查询时间 < 100ms

### 7.2 并发处理
- 支持1000+并发请求
- 转移处理能力 > 100 TPS
- 系统可用性 > 99.9%

## 8. 监控和日志

### 8.1 监控指标
- API调用次数和响应时间
- 转移成功率和失败率
- 系统资源使用情况
- 错误率和异常情况

### 8.2 日志记录
- 所有API调用记录
- 转移操作详细日志
- 错误和异常日志
- 安全事件日志

## 9. 版本管理

### 9.1 版本策略
- 使用语义化版本号（SemVer）
- 向后兼容性保证
- 废弃功能提前通知

### 9.2 版本信息
- 当前版本：v1.0.0
- 发布日期：2025-01-18
- 兼容版本：v1.x.x

## 10. 实施指南

### 10.1 集成步骤
1. 注册游戏钱包
2. 配置资产信息
3. 实现API接口
4. 测试集成功能
5. 上线生产环境

### 10.2 测试要求
- 单元测试覆盖率 > 80%
- 集成测试覆盖所有API
- 性能测试验证响应时间
- 安全测试验证防护机制

## 11. 未来规划

### 11.1 功能扩展
- 支持更多资产类型
- 增加批量转移功能
- 实现智能合约集成
- 添加跨链支持

### 11.2 技术升级
- 微服务架构优化
- 区块链技术集成
- AI智能推荐
- 大数据分析

---

**文档版本**: v1.0.0  
**最后更新**: 2025-01-18  
**维护团队**: 游戏链路协议开发组